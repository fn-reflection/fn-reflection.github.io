{"pageProps":{"post":{"date":"2021-08-07","excerpt":"yarnを扱う上での便利コマンド","slug":"yarn","title":"yarn","content":"<h2>yarnとは</h2>\n<p>yarnはnode.jsなどを主としたソフトウェアを作るときにパッケージ(例えば他の人が作成した外部プログラム)を利用する上で便利なツールである。このようなツールはパッケージマネージャーとも呼ばれていて、非常に類似したものとしてはnpmがあるし、他の言語ではpip(python)、bundle(ruby)、maven(java)などが、OSではbrew(mac)やapt,dnf,yum,pacman(linux)などのツールがパッケージマネージャーとして利用されている。</p>\n<p>node.jsはjavascriptの実行環境の一つであり、サーバーアプリケーションに使う他、webブラウザで動作するjavascriptを構築するためのツールがあるため、webフロントエンド開発にも使用されることが多い。</p>\n<p>所感：npmもyarnも使い方はほとんど変わらないので、迷っている場合はどちらでも良い。</p>\n<h2>yarnの基本</h2>\n<p>package.jsonというファイルをもとに利用するパッケージの名称を指定したりバージョンを(範囲)指定する。yarnを使ってパッケージを取得すると、yarn.lockというファイルが作られそこにパッケージのバージョンの正確な値などが記録される。</p>\n<p>パッケージを取得するとnode_modulesというディレクトリに保存され、パッケージ取得をやり直したい場合はnode_modulesディレクトリを消せば元の状態に戻る。</p>\n<h2>package.jsonの例</h2>\n<p>※下の例では<code>//</code>以降に解説を記述するがpackage.jsonは普通のjsonファイルでありこのような記法は許容されないので、実際に利用するときは解説を除去すること</p>\n<p>他の人の作ったパッケージを利用するだけならdependencies系が特に重要。パッケージを公開する場合はバージョンやライセンスなども重要になる。</p>\n<pre class=\"shiki\" style=\"background-color: #002B36\"><code><span class=\"line\"><span style=\"color: #93A1A1\">{</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"name\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"my-new-project\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトの名前</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"version\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"1.0.0\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトのバージョン</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"description\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"説明用\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// プロジェクトの説明</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"main\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"index.js\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// エントリーポイント</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"repository\"</span><span style=\"color: #93A1A1\">: { </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトが管理されているリポジトリ(例えばgithub)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"url\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"https://example.com/your-username/my-new-project\"</span><span style=\"color: #93A1A1\">,</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"type\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"git\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"author\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"Your Name &#x3C;you@example.com>\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// 名前とemail</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"license\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"MIT\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトに適用するライセンス</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"scripts\"</span><span style=\"color: #93A1A1\">: {</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"build\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"babel src -d lib\"</span><span style=\"color: #93A1A1\">, </span><span style=\"color: #657B83; font-style: italic\">// yarn buildを実行するとbabel src -d libコマンドが実行される</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"test\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"jest\"</span><span style=\"color: #93A1A1\">　</span><span style=\"color: #657B83; font-style: italic\">// yarn testを実行するとjestコマンドが実行される</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  }</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #2AA198\">\"dependencies\"</span><span style=\"color: #D30102\">:</span><span style=\"color: #93A1A1\"> { </span><span style=\"color: #657B83; font-style: italic\">// 使用するパッケージリスト</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"vue\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"^2.6.12\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"devDependencies\"</span><span style=\"color: #93A1A1\">: { </span><span style=\"color: #657B83; font-style: italic\">// 開発時にのみ使用するパッケージリスト(具体的には環境変数NODE_ENV=productionにセットされた場合などは無視される)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"vue-test-utils\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"^1.0.0-beta.11\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"peerDependencies\"</span><span style=\"color: #93A1A1\">: { </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトを利用するプロジェクトに使用させるパッケージリスト(例えばeslintやreactなどのプラグインを作成するときなどに使うらしい)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"eslint\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"^2.3.19\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"optionalDependencies\"</span><span style=\"color: #93A1A1\">: { </span><span style=\"color: #657B83; font-style: italic\">// 必須ではないパッケージリスト、取得できなくてもエラーにならない。</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"watchman\"</span><span style=\"color: #93A1A1\">: </span><span style=\"color: #2AA198\">\"^2.3.19\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span><span style=\"color: #859900\">\"bundledDependencies\"</span><span style=\"color: #93A1A1\">: { </span><span style=\"color: #657B83; font-style: italic\">// このプロジェクトをモジュールとして公開するときにモジュールとして一緒に保持するパッケージリスト</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">    </span><span style=\"color: #859900\">\"vue\"</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  },</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">  </span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<h2>パッケージハンドリング</h2>\n<pre class=\"shiki\" style=\"background-color: #002B36\"><code><span class=\"line\"><span style=\"color: #93A1A1\">yarn init </span><span style=\"color: #657B83; font-style: italic\"># yarnプロジェクトのベースになるpackage.jsonを対話形式で作成する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn </span><span style=\"color: #657B83; font-style: italic\"># package.jsonの情報に基づきパッケージをnode_modulesディレクトリに取得する。</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn install </span><span style=\"color: #657B83; font-style: italic\"># yarnと同じ</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn install --check-files </span><span style=\"color: #657B83; font-style: italic\"># パッケージが確かに取得されていることを確認する。</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn install --force </span><span style=\"color: #657B83; font-style: italic\"># node_modulesに強制ダウンロード(これするよりは普通にnode_module消してyarnした方が簡単かも)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn install --production </span><span style=\"color: #657B83; font-style: italic\"># dependenciesのパッケージのみ取得する。(devDependenciesのとかは取得しない。)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn install --prod </span><span style=\"color: #657B83; font-style: italic\"># yarn install --productionと同じ</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package@version </span><span style=\"color: #657B83; font-style: italic\">#パッケージを緩くバージョン指定してdependenciesに追加(1.2.4なら1.2.4以上2.0.0未満の最新バージョン)</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package@version --exact </span><span style=\"color: #657B83; font-style: italic\"># パッケージを厳格にバージョン指定してdependenciesに追加</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package </span><span style=\"color: #657B83; font-style: italic\"># = yarn add package@latest 最新バージョンを追加</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package --dev </span><span style=\"color: #657B83; font-style: italic\">#　devDependenciesに追加</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package -D </span><span style=\"color: #657B83; font-style: italic\">#　yarn add package --devと同じ</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package --peer </span><span style=\"color: #657B83; font-style: italic\"># peerDependenciesに追加</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn add package --optional </span><span style=\"color: #657B83; font-style: italic\"># optionalDependenciesに追加</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn global add package </span><span style=\"color: #657B83; font-style: italic\"># プロジェクトではなくユーザー環境にパッケージを取得する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn global dir </span><span style=\"color: #657B83; font-style: italic\"># ユーザー環境にパッケージを取得する場合、その保存パスを表示する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn upgrade package@version </span><span style=\"color: #657B83; font-style: italic\"># パッケージを指定したバージョンに更新する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn upgrade package </span><span style=\"color: #657B83; font-style: italic\"># パッケージを最新バージョンに更新する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn remove package </span><span style=\"color: #657B83; font-style: italic\"># パッケージをdependenciesから削除する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn why package </span><span style=\"color: #657B83; font-style: italic\"># パッケージが取得されている理由を検索する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn config </span><span style=\"color: #268BD2\">set</span><span style=\"color: #93A1A1\"> cache-folder </span><span style=\"color: #859900\">&#x3C;</span><span style=\"color: #93A1A1\">path</span><span style=\"color: #859900\">></span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># パッケージのキャッシュディレクトリを変更する、ebsとかを登録すると捗る？</span></span></code></pre>\n<h2>スクリプトの実行とか</h2>\n<pre class=\"shiki\" style=\"background-color: #002B36\"><code><span class=\"line\"><span style=\"color: #93A1A1\">yarn run </span><span style=\"color: #657B83; font-style: italic\"># 実行可能なスクリプトコマンドを列挙する</span></span>\n<span class=\"line\"><span style=\"color: #93A1A1\">yarn run env </span><span style=\"color: #657B83; font-style: italic\"># スクリプト実行時の環境変数を列挙する</span></span></code></pre>\n<h2>バージョン指定の記法</h2>\n<pre class=\"shiki\" style=\"background-color: #002B36\"><code><span class=\"line\"><span style=\"color: #2AA198\">'~3.1.4'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 3.1.4以上 3.2.0未満</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'~3.1'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 3.1.0以上 3.2.0未満</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'~3'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 3.0.0以上 4.0.0未満</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'2.x'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># メジャーバージョンが2である任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'3.1.x'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 3.1から始まる任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'=4.6.6'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># バージョン 4.6.6 のみ</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'=3.1.4-beta.2'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># ベータ版も指定できる</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'>0.4.2'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 0.4.2 を超える任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'>=2.7.1'</span><span style=\"color: #93A1A1\">\t</span><span style=\"color: #657B83; font-style: italic\"># 2.7.1 以上の任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'&#x3C;2.0.0'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 2.0.0 未満の任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'&#x3C;=3.1.4'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\">#\t3.1.4 以下の任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">\">=2.0.0 &#x3C;3.1.4\"</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\">#  2.0.0 以上 3.14未満の任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'2.0.0 - 3.1.4'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\">#  2.0.0 以上 3.14以下の任意のバージョン</span></span>\n<span class=\"line\"><span style=\"color: #2AA198\">'*'</span><span style=\"color: #93A1A1\"> </span><span style=\"color: #657B83; font-style: italic\"># 任意のバージョン</span></span></code></pre>\n<h2>yarn vs npm</h2>\n<p>yarnの公式ドキュメントより抜粋</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th align=\"left\">npm (v5)</th><th align=\"left\">Yarn</th></tr></thead><tbody><tr><td align=\"left\"><code>npm install</code></td><td align=\"left\"><code>yarn install</code></td></tr><tr><td align=\"left\">ない</td><td align=\"left\"><code>yarn install --flat</code></td></tr><tr><td align=\"left\">ない</td><td align=\"left\"><code>yarn install --har</code></td></tr><tr><td align=\"left\"><code>npm install --no-package-lock</code></td><td align=\"left\"><code>yarn install --no-lockfile</code></td></tr><tr><td align=\"left\">ない</td><td align=\"left\"><code>yarn install --pure-lockfile</code></td></tr><tr><td align=\"left\"><code>npm install [package]</code></td><td align=\"left\"><code>yarn add [package]</code></td></tr><tr><td align=\"left\"><code>npm install [package] --save-dev</code></td><td align=\"left\"><code>yarn add [package] --dev</code></td></tr><tr><td align=\"left\">ない</td><td align=\"left\"><code>yarn add [package] --peer</code></td></tr><tr><td align=\"left\"><code>npm install [package] --save-optional</code></td><td align=\"left\"><code>yarn add [package] --optional</code></td></tr><tr><td align=\"left\"><code>npm install [package] --save-exact</code></td><td align=\"left\"><code>yarn add [package] --exact</code></td></tr><tr><td align=\"left\">ない</td><td align=\"left\"><code>yarn add [package] --tilde</code></td></tr><tr><td align=\"left\"><code>npm install [package] --global</code></td><td align=\"left\"><code>yarn global add [package]</code></td></tr><tr><td align=\"left\"><code>npm update --global</code></td><td align=\"left\"><code>yarn global upgrade</code></td></tr><tr><td align=\"left\"><code>npm rebuild</code></td><td align=\"left\"><code>yarn install --force</code></td></tr><tr><td align=\"left\"><code>npm uninstall [package]</code></td><td align=\"left\"><code>yarn remove [package]</code></td></tr><tr><td align=\"left\"><code>npm cache clean</code></td><td align=\"left\"><code>yarn cache clean [package]</code></td></tr><tr><td align=\"left\"><code>rm -rf node_modules &#x26;&#x26; npm install</code></td><td align=\"left\"><code>yarn upgrade</code></td></tr></tbody></table>"}},"__N_SSG":true}